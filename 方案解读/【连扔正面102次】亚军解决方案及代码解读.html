<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑 Light" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="YXBJ Windows/605766 (zh-CN, DDL); Windows/10.0.0 (Win64); EDAMVersion=V2;"/>
  <style>
    body, td {
      font-family: 微软雅黑 Light;
      font-size: 14pt;
    }
  </style>
</head>
<body>
<a name="10435"/>
<h1>【连扔正面102次】亚军解决方案及代码解读</h1>
<div>
<table bgcolor="#D4DDE5" border="0">
<tr><td><b>创建时间：</b></td><td><i>2021/1/6 19:38</i></td></tr>
<tr><td><b>更新时间：</b></td><td><i>2022/11/1 11:16</i></td></tr>
<tr><td><b>作者：</b></td><td><i>不理不理</i></td></tr>
</table>
</div>
<br/>

<div>
<span><div><div><br/></div><div><span style="font-size: 18pt; font-weight: bold; color: unset; font-family: unset;"><a href="https://github.com/Somezak1/XiaMenBank-Data-Modeling-Competition-2nd-Solution">xgb2代码解读（得分0.802）</a></span><br/></div><div style="text-align: center;"><a href="【连扔正面102次】亚军解决方案及代码解读_files/xgb2_feature_importance.csv"><img src="【连扔正面102次】亚军解决方案及代码解读_files/1a6625958adc3aa82640821e6aee5ee3.png" alt="xgb2_feature_importance.csv"></a></div><div style="margin-left: 40px;">1、读取train和test数据，原始数据中只有train isNew==0部分bankCard约有2W多条记录为Null，train和test的其余原始特征均没有Null，但部分特征值为-999同样意味缺失</div><div><br/></div><div style="margin-left: 40px;">2、对train中isNew==0、'居住地residentAddr'不为-999的统一减去30W，以跟isNew==1<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">保持分布的一致</span><span style="font-weight: bold;">（异常值处理）</span></div><div><br/></div><div style="margin-left: 40px;">3、train中isNew==0的样本记为train1，isNew==1的样本记为train2，<span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">将train2与test拼接为data</span><span style="font-weight: bold;">（保持新生成的统计特征分布一致）</span></div><div><br/></div><div style="margin-left: 40px;">4、根据 &quot;身份证有效期的起始日期certValidBegin&quot; 和 &quot;身份证有效期的结束日期certValidStop&quot;，对data生成 &quot;身份证的有效期certTime&quot;。<span style="font-size: unset; color: unset; font-family: unset;">根据 &quot;申请日(周几)weekday&quot; 和 &quot;申请时段setupHour&quot;，对data生成 &quot;贷款的申请时间week_hour&quot;（相对周一的相对申请时间）</span></div><div><br/></div><div style="margin-left: 40px;">6、根据 &quot;身份证有效期的起始日期certValidBegin&quot; 和 &quot;年龄age&quot;，对train1和data分别生成 &quot;身份证起始日期的年份dt_year&quot;、&quot;身份证起始日期的月份dt_month&quot;、&quot;bk_time&quot; 三个时间特征</div><div><br/></div><div style="margin-left: 40px;"><span style="font-size: unset; color: unset; font-family: unset;">7、对征信信息相关的84个无序类别特征两两计算肯德尔相关系数，剔除相关性为1的特征，剩余47个互不相关的特征，对其中每个特征：<span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">（利用统计特征替换掉单一特征，规避高维特征稀疏字段对于预测的影响）</span></span></div><div style="margin-left: 80px;"><span style="font-size: unset; color: unset; font-family: unset;">7.1    生成data.groupby([ &quot;申请日(周几)weekday&quot;, 该特征 ])[ 该特征 ].transform( &quot;count&quot; )</span></div><div style="margin-left: 80px;"><span style="font-size: unset; color: unset; font-family: unset;">7.2</span><span style="font-size: unset; color: unset; font-family: unset;">    </span><span style="font-size: unset; color: unset; font-family: unset;">生成data.groupby([ &quot;申请时段setupHour&quot;, 该特征 ])[ 该特征 ].transform( &quot;count&quot; )</span></div><div style="margin-left: 80px;"><span style="font-size: unset; color: unset; font-family: unset;">7.3</span><span style="font-size: unset; color: unset; font-family: unset;">    </span><span style="font-size: unset; color: unset; font-family: unset;">生成data.groupby( 该特征 )[ &quot;预授信金额lmt&quot; ].transform( &quot;mean&quot;/&quot;max&quot;/&quot;min&quot;/&quot;std&quot; )</span></div><div><br/></div><div style="margin-left: 40px;">8、记【 &quot;身份证起始日期的年份dt_year&quot;、&quot;身份证起始日期的月份dt_month&quot;、&quot;民族ethnic&quot;、&quot;最高学历highestEdu&quot;、&quot;地区dist&quot;、&quot;单位类型job&quot;、&quot;性别gender&quot;、&quot;<span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">年龄age</span>&quot;、&quot;贷款产品类型loanProduct&quot;、&quot;贷款预授信金额lmt&quot;、&quot;贷款基础评级basicLevel&quot;、&quot;放款卡号bankCard&quot;、&quot;居住地residentAddr&quot;、&quot;联系人关系linkRela&quot;、&quot;申请时段setupHour&quot;、&quot;申请日(周几)weekday&quot; 】这些特征构成的集合为feat_set<span style="font-weight: bold;">（囊括了除 &quot;证件号certId&quot;、&quot;用户唯一标识id&quot;、&quot;学历edu&quot;、&quot;标签target&quot; 以外的所有基本特征+借贷特征）</span></div><div style="margin-left: 80px;"><span style="font-size: unset; color: unset; font-family: unset;">8.1    对feat_set中的每个特征：</span></div><div style="margin-left: 120px;"><span style="font-size: unset; color: unset; font-family: unset;">8.1.1    生成data.groupby( 该特征 )[ 该特征 ].transform( &quot;count&quot; )</span></div><div style="margin-left: 120px;"><span style="font-size: unset; color: unset; font-family: unset;">8.1.2</span><span style="font-size: unset; color: unset; font-family: unset;">    </span><span style="font-size: unset; color: unset; font-family: unset;">计算train1.groupby( 该特征 )[ </span><span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">标签</span><span style="font-size: unset; color: unset; font-family: unset;"> ].agg( &quot;sum&quot; )，并根据该特征merge到data中</span><span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">（注意，作者此处没有采用K折交叉验证的方式来生成特征，而是通过线下检验剔除了易过拟合的特征）</span></div><div style="margin-left: 120px;"><span style="font-size: unset; color: unset; font-family: unset;">8.1.3</span><span style="font-size: unset; color: unset; font-family: unset;">    </span><span style="font-size: unset; color: unset; font-family: unset;">生成data.groupby( 该特征 )[ 该特征 ].transform( &quot;count&quot; ) /</span> <span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">(</span> <span style="font-size: unset; color: unset; font-family: unset;">3 + ( train1.groupby( 该特征 )[ 标签 ].agg( &quot;count&quot; ) merge到data ) </span><span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">)</span></div><div style="margin-left: 120px;"><span style="font-size: unset;"><br/></span></div><div style="margin-left: 80px;"><span style="font-size: unset; color: unset; font-family: unset;">8.2    对feat_set 剔除 &quot;申请日(周几)weekday&quot;</span> <span style="font-size: unset; color: unset; font-family: unset;">后</span><span style="font-size: unset; color: unset; font-family: unset;">剩余</span><span style="font-size: unset; color: unset; font-family: unset;">的每个特征：</span><span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">（</span><span style="font-weight: bold;">通过工作日与工作时间来挖掘用户的潜在信息</span><span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">）</span></div><div style="margin-left: 120px;"><span style="font-size: unset; color: unset; font-family: unset;">8.2.1</span><span style="font-size: unset; color: unset; font-family: unset;">    </span><span style="font-size: unset; color: unset; font-family: unset;">生成data.groupby([ &quot;申请日(周几)weekday&quot;, 该特征 ])[ 该特征 ].transform( &quot;count&quot; )</span></div><div style="margin-left: 120px;"><span style="font-size: unset;"><br/></span></div><div style="margin-left: 80px;"><span style="font-size: unset; color: unset; font-family: unset;">8.3    对feat_set </span><span style="font-size: unset; color: unset; font-family: unset;">剔除</span> <span style="font-size: unset; color: unset; font-family: unset;">&quot;贷款产品类型</span>loanProduct<span style="font-size: unset; color: unset; font-family: unset;">&quot;</span> <span style="font-size: unset; color: unset; font-family: unset;">后剩余</span><span style="font-size: unset; color: unset; font-family: unset;">的每个特征：<span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">（</span></span><span style="font-weight: bold;">挖掘不同的借贷产品对于不同用户，不同时间，不同地点等的相关信息</span><span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">）</span></div><div style="margin-left: 120px;"><span style="font-size: unset; color: unset; font-family: unset;">8.3.1</span><span style="font-size: unset; color: unset; font-family: unset;">    </span><span style="font-size: unset; color: unset; font-family: unset;">计算train1.groupby([ &quot;</span>贷款产品类型loanProduct<span style="font-size: unset; color: unset; font-family: unset;">&quot;, 该特征 ])[ </span><span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">标签</span><span style="font-size: unset; color: unset; font-family: unset;"> ].transform( &quot;mean&quot; )，并根据 &quot;</span>贷款产品类型loanProduct<span style="font-size: unset; color: unset; font-family: unset;">&quot; 和该特征merge到data中</span><span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">（注意，作者此处没有采用</span><span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">K</span><span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">折交叉验证的方式来生成特征，而是通过线下检验剔除了易过拟合的特征）</span></div><div style="margin-left: 120px;"><span style="font-size: unset; color: unset; font-family: unset;">8.3.2</span><span style="font-size: unset; color: unset; font-family: unset;">    </span><span style="font-size: unset; color: unset; font-family: unset;">生成data.groupby([ &quot;</span>贷款产品类型loanProduct<span style="font-size: unset; color: unset; font-family: unset;">&quot;, 该特征 ])[ 该特征 ].transform( &quot;count&quot; ) /</span> <span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">(</span> <span style="font-size: unset; color: unset; font-family: unset;">3 + ( train1.groupby([ &quot;</span>贷款产品类型loanProduct<span style="font-size: unset; color: unset; font-family: unset;">&quot;, 该特征 ])[ 标签 ].agg( &quot;count&quot; ) merge到data ) </span><span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">)</span></div><div style="margin-left: 120px;"><span style="font-size: unset;"><br/></span></div><div style="margin-left: 80px;"><span style="font-size: unset; color: unset; font-family: unset;">8.4    对feat_set 剔除 &quot;居住地residentAddr&quot; 后</span><span style="font-size: unset; color: unset; font-family: unset;">剩余</span><span style="font-size: unset; color: unset; font-family: unset;">的每个特征：<span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">（</span></span><span style="font-weight: bold;">统计出一个地区用户的喜好，习惯，消费水平等</span><span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">潜在信息</span><span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">）</span></div><div style="margin-left: 120px;"><span style="font-size: unset; color: unset; font-family: unset;">8.4.1</span><span style="font-size: unset; color: unset; font-family: unset;">    </span><span style="font-size: unset; color: unset; font-family: unset;">生成data.groupby([ &quot;居住地residentAddr&quot;, 该特征 ])[ 该特征 ].transform( &quot;count&quot; ) /</span> <span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">(</span> <span style="font-size: unset; color: unset; font-family: unset;">3 + ( train1.groupby([ &quot;居住地residentAddr&quot;, 该特征 ])[ 标签 ].agg( &quot;count&quot; ) merge到data ) </span><span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">)</span></div><div style="margin-left: 80px;"><span style="font-size: unset;"><br/></span></div><div style="margin-left: 80px;"><span style="font-weight: bold;">此处利用全部信息的同时消除新旧数据分布不一致的情况</span></div><div><br/></div><div style="margin-left: 40px;">9、记【 &quot;贷款产品类型loanProduct&quot;、&quot;贷款预授信金额Imt&quot;、&quot;贷款基础评级basicLevel&quot;、&quot;放款卡号bankCard&quot;、&quot;居住地residentAddr&quot;、&quot;联系人关系linkRela&quot;、 &quot;<span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">申请时段setupHour</span>&quot;<span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">、&quot;</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">申请日(周几)weekday</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">&quot; </span>】<span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">为unique_col</span><span style="font-weight: bold;">（所有借贷特征）</span><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-variant-caps: normal; font-variant-ligatures: normal;">，对unique_col中的两两特征col和col1：</span></div><div style="margin-left: 80px;"><span style="font-size: unset; color: unset; font-family: unset;">9.1    生成data.groupby( col )[ col1 ].transform( &quot;nunique&quot; )</span></div><div style="margin-left: 80px;"><span style="font-size: unset; color: unset; font-family: unset;">9.2    生成data.groupby( col )[ col1 ].transform( &quot;nunique&quot; ) /</span> <span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">(</span> <span style="font-size: unset; color: unset; font-family: unset;">3 + ( train1.groupby( col )[ col1 ].agg( &quot;nunique&quot; ) merge到data ) </span><span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">)</span></div><div><br/></div><div style="margin-left: 40px;"><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">10、对data中的 &quot;贷款产品类型loanProduct&quot; 进行one-hot展开</span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div style="margin-left: 40px;"><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">11、将由train2和test组成的data按原样拆分成train和test（注意，官方提供的原始特征依然得到了保留）</span></div><div><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><br/></span></div><div style="margin-left: 40px;"><span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px;">12、将train拆分成五折进行交叉验证，每一折的训练集是原本该折训练集+train1中标签为1的样本。</span><span style="color: unset; font-family: unset;">去除特征中的 &quot;用户唯一标识id&quot;、&quot;标签target&quot;、&quot;证件号certId&quot;、&quot;地区dist&quot; 这几个特征</span></div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 18pt; font-weight: bold;">xgb1代码解读（得分0.788）</span></div><div style="margin-left: 40px;">略</div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 18pt; color: unset; font-family: unset; font-weight: bold;">lgb代码解读（得分0.709）</span></div><div style="text-align: center;"><a href="【连扔正面102次】亚军解决方案及代码解读_files/lgb_feature_importance.csv"><img src="【连扔正面102次】亚军解决方案及代码解读_files/afe7eb83bb666ff5b352f84e966c8d09.png" alt="lgb_feature_importance.csv"></a></div><div style="margin-left: 40px;">1、读取train和test数据，原始数据中只有train isNew==0部分bankCard约有2W多条记录为Null，train和test的其余原始特征均没有Null，但部分特征值为-999同样意味缺失</div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;">2、去除train中train.target==0且 &quot;预授信金额lmt&quot; 在[5, 5.2]或[6, 6.2]之间的样本，以保持训练集和测试集 &quot;预授信金额lmt&quot; <span style="background-color: rgb(255, 250, 165);-evernote-highlight:true;">分布的一致</span><span style="font-weight: bold;">（异常值处理）</span></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;">3、用-999填充test的标签，并将train和test拼接为data<span style="font-weight: bold;">（拼接也可以使得后续groupby生成的统计特征在train和test上分布一致）</span></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;">4、用-999填充 &quot;放款卡号bankCard&quot; 的缺失值，至此，data中所有缺失都用-999表示了</div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;">5、根据 &quot;x_0&quot; 到 &quot;x_78&quot; 这79个征信特征，对每个样本分别生成这79个特征的sum和var</div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;">6、假设isnew=0的数据为两个月前的数据（微信群提到），通过组合特征提取相关特征</div><div style="margin-left: 80px;">6.1    计算data.loc[data.isNew==1].groupby( &quot;证件号certId&quot; )[ &quot;id&quot; ].count()，然后根据 &quot;证件号certId&quot; merge到data上<span style="font-weight: bold;">（新数据里每个证件号的出现次数）</span></div><div style="margin-left: 80px;">6.2    计算data.loc[data.isNew==0].groupby( &quot;证件号certId&quot; )[ &quot;id&quot; ].count()，然后根据 &quot;证件号certId&quot; merge到data上 <span style="font-size: medium; letter-spacing: normal; orphans: 2; text-indent: 0px; text-transform: none; white-space: normal; widows: 2; word-spacing: 0px; -webkit-text-stroke-width: 0px; color: rgb(0, 0, 0); font-family: &quot;微软雅黑 Light&quot;; font-variant-caps: normal; font-variant-ligatures: normal; font-weight: bold;">（旧数据里每个证件号的出现次数）</span></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;">7、对 &quot;证件号certId&quot;, &quot;地区dist&quot;, &quot;单位类型job&quot;, &quot;预授信金额lmt&quot;, &quot;放款卡号bankCard&quot;, &quot;居住地residentAddr&quot;, &quot;申请日(周几)weekday&quot;, &quot;申请时段setupHour&quot;, &quot;民族ethnic&quot; 中的每个特征f，构造计数和排序特征：</div><div style="margin-left: 80px;">7.1    data.groupby( 该特征f )[ &quot;id&quot; ].transform( &quot;count&quot; )</div><div style="margin-left: 80px;">7.2    data.groupby( 该特征f )[ &quot;id&quot; ].transform( &quot;rank&quot; )（该特征相同的按id从小到大排序）</div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;">8、对缺失值特征 &quot;放款卡号bankCard&quot;, &quot;居住地residentAddr&quot;, &quot;最高学历highestEdu&quot;, &quot;联系人关系linkRela&quot; 中的每个特征f，<span style="font-weight: bold;">构造与缺失值有关的计数特征</span>：</div><div style="margin-left: 80px;">8.0    取a = data.loc[data[ 该特征f ]==-999]，及在该特征上值缺失的样本</div><div style="margin-left: 80px;">8.1    计算a.groupby([ &quot;证件号certId&quot; ])[ &quot;id&quot; ].count()，然后根据 &quot;证件号certId&quot; merge到data上</div><div style="margin-left: 80px;">8.2    计算a.groupby([ &quot;产品类型loanProduct&quot; ])[ &quot;id&quot; ].count()，然后根据 &quot;产品类型loanProduct&quot; merge到data上</div><div style="margin-left: 80px;">8.3    计算a.groupby([ &quot;单位类型job&quot; ])[ &quot;id&quot; ].count()，然后根据 &quot;单位类型job&quot; merge到data上</div><div style="margin-left: 80px;">8.4    计算该特征在8.1生成的特征/ &quot;证件号certId&quot; 在7.1生成的特征，并添加到data上</div><div style="margin-left: 80px;">8.5    计算该特征在8.3生成的特征/ &quot;单位类型job&quot; 在7.1生成的特征，并添加到data上<span style="font-weight: bold;">（8.4和8.5同理，以8.5举例，假设data中有100个人在海事局工作，放款卡号缺失的人中有60个人在海事局工作，表明在海事局工作的人放款卡号信息容易缺失；再假设data中有100个人在银行工作，而居住地缺失的人中只有2个在银行工作，则表明在银行工作的人不容易居住地信息缺失）</span></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;">9、根据 &quot;身份证有效期的起始日期certValidBegin&quot; 和 &quot;身份证有效期的结束日期certValidStop&quot;，生成当下距离身份证有效期起始日期的天数特征，以及身份证有效期特征</div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;">10、删除&quot;身份证有效期的起始日期certValidBegin&quot;、&quot;身份证有效期的结束日期certValidStop&quot;、&quot;5yearBadloan&quot;、以及&quot;单位类型job&quot;在7.2生成的特征</div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;">11、&quot;预授信金额lmt&quot; 是重要特征，因此对 &quot;证件号certId&quot;、&quot;放款卡号bankCard&quot; 中的每个特征f，生成data.groupby( 该特征f )[ &quot;预授信金额lmt&quot; ].transform( &quot;nunique&quot; )<span style="font-weight: bold;">（以 &quot;证件号certId&quot; 为例，该特征即为同一地区的人预授信金额的不同的数量）</span></div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;">12、生成 &quot;放款卡号bankCard&quot; 是否缺失的特征，生成 &quot;证件号certId&quot; 与 &quot;地区dist&quot; 的差的绝对值（贷款地与原户籍地差），生成 &quot;证件号certId&quot; 与 &quot;居住地residentAddr&quot; 的差的绝对值</div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;">13、根据EDA扔掉了一些不好的特征</div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;">14、将data重新拆分成train和test，去除 &quot;target&quot; 和 &quot;id&quot; 特征，使用lgb模型进行十折交叉验证训练</div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 18pt; font-weight: bold;">Ensemble</span></div><div style="margin-left: 40px;">最后lgb、xgb1、xgb2三个模型分别以0.06、0.09、0.85的比例进行blending融合</div><div><br/></div><div><br/></div><div><br/></div><div><span style="font-size: 18pt; font-weight: bold;">心得</span></div><div style="margin-left: 40px;">学习到这样的特征工程方式</div><div style="margin-left: 80px;">① data.groupby([feat])[other1].count()</div><div style="margin-left: 80px;">② data.groupby([feat])[other1].mean()/nunique()/...</div><div style="margin-left: 80px;"><br/></div><div style="margin-left: 80px;">③ data.groupby([feat, other2])[other1].count()</div><div style="margin-left: 80px;">④ data.groupby([feat, other2])[other1].mean()/nunique()/...</div><div style="margin-left: 40px;"><br/></div><div style="margin-left: 40px;">在data_subset上按上述生成的特征与在data上按上述生成特征的比值</div><div style="margin-left: 40px;">比如 ( data_subset.③ merge到data上 / ( data.③ + θ ) )</div><div><br/></div><ul><li><div>对数据集进行采样，使得重要特征在训练集和测试集上的分布接近</div></li><li><div>对样本进行下采样以缓解严重的类别不平衡问题</div></li><li><div>对于意义不明的高维稀疏特征，可以使用相关系数剔除部分冗余特征，之后再根据统计特征替换掉这些高维稀疏特征以规避稀疏片段对于预测结果的影响</div></li><li><div>筛选离群点对异常值进行过滤</div></li><li><div>需要分别关注训练集和测试集中每个特征与标签y的关系</div></li><li><div>组合特征提取高维稀疏特征中可能有用的信息</div></li><li><div>可以从以下5个维度进行特征筛选：①去除高缺失比例的特征  ②去除高相关性的特征  ③去除zero importance的特征  ④去除low importance的特征  ⑤去除值都一样的特征</div></li><li><div>类别型变量与类别型变量构造的统计特征：</div></li></ul><div><span style="font-size: unset; color: unset; font-family: unset;">        data.groupby([ &quot;申请日(周几)weekday&quot;, 该特征 ])[ 该特征 ].transform( &quot;count&quot; )</span></div><div><span style="font-size: unset; color: unset; font-family: unset;">        data.groupby( col )[ col1 ].transform( &quot;nunique&quot; )</span></div><ul><li><div>类别型变量与数值型变量构造的统计特征：</div></li></ul><div><span style="font-size: unset; color: unset; font-family: unset;">        data.groupby( 该特征 )[ &quot;预授信金额lmt&quot; ].transform( &quot;mean&quot;/&quot;max&quot;/&quot;min&quot;/&quot;std&quot; )</span></div><div><span style="font-size: unset; color: unset; font-family: unset;">        data.groupby( col )[ col1 ].transform( &quot;nunique&quot; )</span></div><ul><li><div>利用不直接用于建模的历史信息进行target encoding，然后将信息整合到需要建模的最新数据中去</div></li></ul><div><span style="font-size: unset; color: unset; font-family: unset;">        train1.groupby([ &quot;</span>贷款产品类型loanProduct<span style="font-size: unset; color: unset; font-family: unset;">&quot;, 该特征 ])[ </span><span style="font-size: unset; color: unset; font-family: unset; font-weight: bold;">标签</span><span style="font-size: unset; color: unset; font-family: unset;"> ].transform( &quot;mean&quot; )</span></div><div><span style="font-size: unset;"><br/></span></div><div><br/></div></div><div><br/></div></span>
</div></body></html> 